# Next Pane: Ctrl-b + o
# toggle between current and previous pane: Ctrl-b + ;
# Specific Direction: Ctrl-b + q (this will show pane numbers; press the number to go to that pane)
# Swap with the next pane: Ctrl-b + }
# Swap with the previous pane: Ctrl-b + {

set -g escape-time 0
set -g repeat-time 0

## smart pane switching with awareness of vim splits ##
bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-l) || tmux select-pane -R"

## move around even in copy-mode ##
bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R

# Enable 24 bit true colors
# set -ga terminal-overrides ',*:RGB'

# do not exit tmux on destroy
set-option -g detach-on-destroy off

set -g default-terminal 'xterm-256color'
set -sa terminal-overrides ',*256color*:Tc:sitm=\E[3m'

if-shell "[[ -n $SSH_CLIENT ]]" 'set -g default-terminal "xterm-256color"'

set-option -g status-position top

unbind q
# unbind-key -T copy-mode-vi H
# unbind-key -T copy-mode-vi L

bind-key P choose-buffer
bind-key + delete-buffer \; display-message "Deleted current Tmux Clipboard History"

bind-key -T copy-mode-vi v send-keys -X begin-selection \; send-keys -X rectangle-toggle
bind-key -T copy-mode-vi V send-keys -X select-line
bind-key -T choice-mode-vi h send-keys -X tree-collapse
bind-key -T choice-mode-vi l send-keys -X tree-expand
bind-key -T choice-mode-vi H send-keys -X tree-collapse-all
bind-key -T choice-mode-vi L send-keys -X tree-expand-all
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel
bind-key -T copy-mode-vi L send-keys -X end-of-line
bind-key -T copy-mode-vi H send-keys -X back-to-indentation

## pane and window numbering ##
set -g base-index 1
set -g pane-base-index 1

## set window titles ##
set-window-option -g automatic-rename on
set-option -g set-titles on
set-option -g set-titles-string "#T"

set-option -g automatic-rename-format "#{?#{==:#{pane_current_command},zsh},#{b:pane_current_path},#{pane_current_command}}"

set -g allow-rename off

## status bar update interval ##
set -g status-interval 1

# shortpath is link to ~/.dotfiles/shortpath
# set -g pane-border-format " #(echo '#{pane_current_path}' | shortpath) "

setw -g mode-keys vi
set -g status-keys vi
setw -g mode-keys vi

set -g history-limit 30000

## how we split windows ##

bind c new-window -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}" -p 30
bind '"' split-window -v -c "#{pane_current_path}" -p 30
bind | split-window -h -c "#{pane_current_path}"

## enable mouse ##
set -g mouse on

# bind-key -r j resize-pane -D 7
# bind-key -r k resize-pane -U 7
# bind-key -r h resize-pane -L 7
# bind-key -r l resize-pane -R 7

bind r source-file ~/.tmux.conf \; display-message "Config reloaded..."

unbind y
bind y setw synchronize-panes

## hide tmux status bar on/off ##
set -g status 'on'

# hide status bar ##
# bind h set -g status

set -g monitor-activity on
set -g visual-activity off

# status text color
set -g status-style 'bg=default,fg=#506673'

# message c-b :
set -g message-style fg=blue,bg=default

# Set the format for the active window
# setw -g window-status-format "#I#W "

# ternary operation, returns red,blink if there is activity, otherwise default fg set
is_activity="#{?window_activity_flag,"fg=red,blink","fg=#506673"}"

setw -g window-status-format "#[fg=default]#I#[${is_activity}]•#[fg=default]#W  "
setw -g window-status-current-format "#[fg=default]#I#[fg=green]*#[fg=default]#W  "

setw -g window-status-activity-style "bg=default,blink"
set -g window-status-bell-style "bg=colour208,fg=brightblack,blink"

set -g pane-border-style "fg=#727b8a"
set -g pane-active-border-style "bg=default,fg=#7c8595"

set -g status-justify centre
set -g status-left " "

# icons: 

# Display the current time on the right
set -g status-right " %H:%M:%S "

set-option -g focus-events on

set -g set-clipboard on

tmux_conf_copy_to_os_clipboard=true

unbind-key C-b
unbind-key C-q
unbind-key C-a
set-option -g prefix C-b
bind-key C-b send-prefix

unbind ]
bind-key p paste-buffer
unbind C-z
unbind C-m
unbind m
bind-key C-m resize-pane -Z

bind-key -n M-] next-window
bind-key -n M-[ previous-window

# move panes faster, in macos, map this to command+(jhkl) in terminal
bind-key -n C-l select-pane -R
bind-key -n C-h select-pane -L
bind-key -n C-k select-pane -U
bind-key -n C-j select-pane -D

# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'ono7/tmux-pass'

set -g @pass-key k
set -g @pass-copy-to-clipboard on
set -g @pass-window-size 10
set -g @pass-hide-pw-from-preview 'on'

bind C-S-n send-keys C-S-n

# this is the last line on TMUX
# c-b + I (capital I)
run '~/.tmux/plugins/tpm/tpm'
